{"version":3,"sources":["admin.js"],"names":["$","job","ajax","bp","message","errors","nonce","find","data","ready","attr","process","post","ajaxurl","action","done","fail","failed","start","e","preventDefault","val","addClass","html","concat","stop","abort","error","console","clear","removeClass","status","parse","log","count","Number","append","map","entry","length","empty","back","parseJSON","on","jQuery"],"mappings":"cACA,SAAUA,GACR,IAAIC,EAAM,KACNC,EAAO,KACLC,EAAKH,EAAE,eACPI,EAAUJ,EAAE,uBACZK,EAASL,EAAE,sBACXM,EAAQH,EAAGI,KAAK,oBAAoBC,KAAK,SAS/C,SAASC,IACPN,EAAGI,KAAK,sBAAsBG,KAAK,YAAY,GAIjD,SAASC,EAAQA,GACfT,EAAOF,EAAEY,KAAKC,QAAS,CAAEC,OAAQ,aAAcb,IAAAA,EAAKK,MAAAA,EAAOK,QAAAA,IACxDI,KAAKA,GACLC,KAAKC,GAIV,SAASC,EAAMC,GACbA,EAAEC,iBAEFnB,EAAME,EAAGI,KAAK,2BAA2Bc,MAEzCV,EAAQ,SACRR,EAAGmB,SAAS,yBACZlB,EAAQmB,KAAR,UAAAC,OAAuBvB,EAAvB,aAAAuB,OAAsCpB,EAAQI,KAAK,aAIrD,SAASiB,IACP,IACEvB,EAAKwB,QACL,MAAOC,GACPC,QAAQD,MAAR,UAAAH,OAAwBG,IAH1B,QAKEE,IACAlB,EAAQ,QACRR,EAAG2B,YAAY,2CAKnB,SAASf,EAAKP,GAKZ,GAFAuB,EAFAvB,EAAOwB,EAAMxB,IAIO,eAAhBA,EAAKuB,OACP,OAAOpB,EAAQ,OAKnB,SAASM,EAAOT,GACduB,EAAOC,EAAMxB,IACbL,EAAGmB,SAAS,oBAId,SAASS,EAAOvB,GACdJ,EAAQmB,KAAR,UAAAC,OAAuBvB,EAAvB,aAAAuB,OAAsChB,EAAKJ,UAC3CD,EAAGmB,SAAS,cAAgBd,EAAKuB,QACjCE,EAAIzB,EAAKH,QAIX,SAAS4B,EAAIA,GACX,IAAMC,EAAQC,OAAO9B,EAAOE,KAAK,4BAA4BgB,QAC7DlB,EAAOE,KAAK,MAAM6B,OAAOH,EAAII,KAAI,SAAAC,GAAK,MAAA,OAAAd,OAAWc,EAAX,aACtCjC,EAAOE,KAAK,4BAA4BgB,KAAKW,EAAQD,EAAIM,QAI3D,SAASV,IACPxB,EAAOE,KAAK,MAAMiC,QAClBnC,EAAOE,KAAK,4BAA4BgB,KAAK,GAI/C,SAASkB,IACPZ,IACA1B,EAAG2B,YAAY,0DAIjB,SAASE,EAAMxB,GACb,IACE,OAAOR,EAAE0C,UAAUlC,GACnB,MAAOmB,GACP,MAAO,CAAEI,OAAQ,QAAS3B,QAASuB,IAzFvCxB,EAAGwC,GAAG,QAAS,qBAAsBlC,GACrCN,EAAGwC,GAAG,SAAU,mBAAoBzB,GACpCf,EAAGwC,GAAG,QAAS,mBAAoBlB,GACnCtB,EAAGwC,GAAG,QAAS,mBAAoBF,GAZrC,CAqGGG","sourcesContent":["/* Run updater */\n(function($) {\n  let job = null\n  let ajax = null\n  const bp = $('.batchpress')\n  const message = $('.batchpress-message')\n  const errors = $('.batchpress-errors')\n  const nonce = bp.find('.batchpress-form').data('nonce')\n\n  // Events\n  bp.on('click', '.batchpress-option', ready)\n  bp.on('submit', '.batchpress-form', start)\n  bp.on('click', '.batchpress-stop', stop)\n  bp.on('click', '.batchpress-back', back)\n\n  // Start and setup queue\n  function ready() {\n    bp.find('.batchpress-button').attr('disabled', false)\n  }\n\n  // Make the ajax request\n  function process(process) {\n    ajax = $.post(ajaxurl, { action: 'batchpress', job, nonce, process })\n      .done(done)\n      .fail(failed)\n  }\n\n  // Start and setup queue\n  function start(e) {\n    e.preventDefault()\n\n    job = bp.find('input[name=job]:checked').val()\n\n    process('start')\n    bp.addClass('batchpress-processing')\n    message.html(`<small>${job}</small> ${message.data('message')}`)\n  }\n\n  // Stop and clear queue\n  function stop() {\n    try {\n      ajax.abort()\n    } catch (error) {\n      console.error(`Abort: ${error}`)\n    } finally {\n      clear()\n      process('stop')\n      bp.removeClass('batchpress-processing batchpress-error')\n    }\n  }\n\n  // Handle ajax done event\n  function done(data) {\n    data = parse(data)\n\n    status(data)\n\n    if (data.status === 'processing') {\n      return process('run')\n    }\n  }\n\n  // Handle ajax failed event\n  function failed(data) {\n    status(parse(data))\n    bp.addClass('batchpress-error')\n  }\n\n  // Update the on page status\n  function status(data) {\n    message.html(`<small>${job}</small> ${data.message}`)\n    bp.addClass('batchpress-' + data.status)\n    log(data.errors)\n  }\n\n  // Update the error log\n  function log(log) {\n    const count = Number(errors.find('.batchpress-errors-count').html());\n    errors.find('ul').append(log.map(entry => `<li>${entry}</li>`))\n    errors.find('.batchpress-errors-count').html(count + log.length)\n  }\n\n  // Clear logs\n  function clear() {\n    errors.find('ul').empty()\n    errors.find('.batchpress-errors-count').html(0)\n  }\n\n  // Go back to start screen\n  function back() {\n    clear()\n    bp.removeClass('batchpress-done batchpress-error batchpress-processing')\n  }\n\n  // Parse JSON response\n  function parse(data) {\n    try {\n      return $.parseJSON(data)\n    } catch (error) {\n      return { status: 'error', message: error }\n    }\n  }\n})(jQuery)\n"]}